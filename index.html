<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>WARRICK WALLET | GLOBAL CLOUD SYNC</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & Babel -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- PDF Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    <!-- Supabase SDK -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Playfair+Display:ital,wght@1,900&family=Outfit:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --ios-bg: #f2f2f7; }
        body {
            font-family: 'Plus Jakarta Sans', -apple-system, sans-serif;
            -webkit-font-smoothing: antialiased;
            background-color: var(--ios-bg); 
            color: #444;
            overflow-x: hidden;
            touch-action: manipulation;
        }

        .brand-container {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
        }
        @media (min-width: 768px) {
            .brand-container.header-logo {
                align-items: flex-start;
            }
        }
        .brand-text {
            font-family: 'Outfit', sans-serif;
            font-weight: 900;
            letter-spacing: -0.04em;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-transform: uppercase;
            line-height: 1;
        }
        .brand-dot {
            background: linear-gradient(135deg, #2563eb 0%, #7c3aed 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-family: 'Playfair Display', serif;
        }
        .brand-underline {
            margin-top: 4px;
            width: 40px;
            height: 3px;
            background: linear-gradient(90deg, #2563eb, transparent);
            border-radius: 2px;
        }
        .powered-tag {
            margin-top: 8px;
            display: inline-flex;
            align-items: center;
            padding: 4px 12px;
            background: rgba(255, 255, 255, 0.4);
            border-radius: 99px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(4px);
            font-size: 9px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.3em;
            color: #64748b;
        }

        .neumorphic-card {
            background: #e0e5ec;
            border-radius: 50px;
            box-shadow: 20px 20px 60px #bec3c9, -20px -20px 60px #ffffff;
        }
        .neumorphic-input {
            background: #e0e5ec;
            border-radius: 25px;
            box-shadow: inset 6px 6px 12px #bec3c9, inset -6px -6px 12px #ffffff;
            border: none;
            outline: none;
            padding: 12px 25px;
            width: 100%;
            color: #444;
            transition: all 0.2s ease;
        }
        .neumorphic-button {
            background: #777; 
            border-radius: 25px;
            box-shadow: 6px 6px 12px #bec3c9, -6px -6px 12px #ffffff;
            color: white;
            transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1);
        }
        .neumorphic-button:active {
            box-shadow: inset 4px 4px 8px #555, inset -4px -4px 8px #999;
            transform: scale(0.96);
        }

        .smart-input {
            width: 100%;
            padding: 1rem 1.25rem;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 1rem;
            font-weight: 600;
            color: #1e293b;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .smart-input:focus {
            background: white;
            border-color: #2563eb;
            box-shadow: 0 0 0 4px rgba(37, 99, 235, 0.1);
            outline: none;
        }
        .smart-label {
            display: block;
            font-size: 11px;
            font-weight: 800;
            color: #64748b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            margin-left: 0.5rem;
        }
        .avatar-edit-container {
            position: relative;
            width: 140px;
            height: 140px;
            margin: 0 auto 2rem;
        }
        .avatar-edit-preview {
            width: 100%;
            height: 100%;
            border-radius: 3rem;
            overflow: hidden;
            border: 4px solid white;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            background: #f1f5f9;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
        }
        .avatar-edit-preview img { width: 100%; height: 100%; object-fit: cover; }
        .avatar-edit-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            width: 40px;
            height: 40px;
            background: #2563eb;
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 10px 15px -3px rgba(37, 99, 235, 0.4);
            transition: all 0.2s;
        }
        .avatar-edit-badge:hover { transform: scale(1.1); background: #1d4ed8; }
        .form-section-title {
            font-size: 14px;
            font-weight: 800;
            color: #1e293b;
            margin-bottom: 1.5rem;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid #f1f5f9;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .profile-card-container { 
            position: relative; 
            width: 100%; 
            aspect-ratio: 3.5/5; 
            border-radius: 3rem; 
            overflow: hidden; 
            box-shadow: 0 40px 80px -15px rgba(0, 0, 0, 0.4); 
            background: #000;
        }
        .profile-card-image { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            object-position: center 20%;
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }
        .profile-card-container:hover .profile-card-image { transform: scale(1.05); }
        .profile-card-overlay { 
            position: absolute; 
            bottom: 12px; 
            left: 12px; 
            right: 12px; 
            padding: 2rem; 
            background: rgba(255, 255, 255, 0.1); 
            backdrop-filter: blur(25px) saturate(180%); 
            -webkit-backdrop-filter: blur(25px) saturate(180%);
            border-radius: 2.2rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white; 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        .profile-card-gradient {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7) 0%, rgba(0,0,0,0.2) 40%, transparent 100%);
            pointer-events: none;
        }
        .verified-badge { display: inline-flex; align-items: center; justify-content: center; width: 18px; height: 18px; background: white; color: #000; border-radius: 50%; margin-left: 8px; }
        .profile-stat-item { display: flex; align-items: center; gap: 6px; font-size: 13px; font-weight: 600; opacity: 0.9; }
        .edit-profile-trigger { background: white; color: black; padding: 10px 20px; border-radius: 1.2rem; font-weight: 800; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1); }
        .edit-profile-trigger:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(0,0,0,0.2); }
        .edit-profile-trigger:active { transform: translateY(0) scale(0.96); opacity: 0.9; }
        .ios-widget { transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.3s ease; border-radius: 2.2rem; }
        @media (max-width: 768px) { .ios-widget { border-radius: 1.5rem; } }
        .ios-button { transition: all 0.3s cubic-bezier(0.23, 1, 0.32, 1); cursor: pointer; border: none; outline: none; }
        .ios-button:hover { transform: translateY(-1px); filter: brightness(1.05); box-shadow: 0 8px 20px rgba(0,0,0,0.15); }
        .ios-button:active { transform: scale(0.94) translateY(0); filter: brightness(0.9); transition: transform 0.1s ease; }
        
        @keyframes snappyEntrance { 
            from { opacity: 0; transform: scale(0.99) translateY(10px); } 
            to { opacity: 1; transform: scale(1) translateY(0); } 
        }
        .animate-ios { animation: snappyEntrance 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        .reg-teaser {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 255, 255, 0.5);
            padding: 4px 4px 4px 12px;
            border-radius: 999px;
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            margin-top: 16px;
        }
        .reg-teaser button {
            background: #2563eb;
            color: white;
            font-size: 10px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 6px 16px;
            border-radius: 999px;
            transition: all 0.3s ease;
            margin-left: 8px;
        }

        .glassy-admin-btn {
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            color: #1e293b;
            font-size: 9px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            padding: 10px 24px;
            border-radius: 999px;
            transition: all 0.4s cubic-bezier(0.165, 0.84, 0.44, 1);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05), inset 0 1px 0 rgba(255,255,255,0.8);
            display: inline-block;
            text-align: center;
        }
        .glassy-admin-btn:hover {
            background: rgba(255, 255, 255, 0.6);
            box-shadow: 0 6px 16px rgba(0,0,0,0.08);
            transform: translateY(-2px);
            color: #2563eb;
        }
        .glassy-admin-btn:active {
            transform: scale(0.96);
            background: rgba(255, 255, 255, 0.3);
            transition: transform 0.1s ease;
        }
        
        .time-range-btn {
            position: relative;
            background: white !important;
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }
        .time-range-btn.active::after {
            content: '';
            position: absolute;
            bottom: 6px;
            left: 50%;
            transform: translateX(-50%);
            width: 14px;
            height: 2.5px;
            background: #add8e6; 
            border-radius: 10px;
        }

        .balance-slider-bg {
            background: rgba(255, 255, 255, 0.4); 
            backdrop-filter: blur(12px); 
            border: 1px solid rgba(255, 255, 255, 0.6); 
            border-radius: 99px;
            height: 28px;
            width: 110px; 
            position: relative;
            cursor: pointer;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.02);
        }
        .balance-slider-thumb {
            height: 22px;
            width: 22px;
            background: #444;
            border-radius: 50%;
            position: absolute;
            top: 2px;
            left: 2px;
            transition: transform 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 11px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .type-balance .balance-slider-thumb { background: #2563eb; }
        .type-balance.active .balance-slider-thumb { transform: translateX(84px); background: #10b981; }
        .type-balance .balance-slider-text { color: #2563eb; }
        .type-income .balance-slider-thumb { background: #10b981; }
        .type-income.active .balance-slider-thumb { transform: translateX(84px); }
        .type-income .balance-slider-text { color: #059669; }
        .type-expense .balance-slider-thumb { background: #e11d48; }
        .type-expense.active .balance-slider-thumb { transform: translateX(84px); }
        .type-expense .balance-slider-text { color: #be123c; }

        .balance-slider-text {
            position: absolute;
            width: 100%;
            text-align: center;
            font-size: 8px; 
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            top: 50%;
            transform: translateY(-50%);
            padding-left: 22px;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .ad-banner {
            flex: 1;
            margin: 0 24px;
            height: 60px;
            background: rgba(255, 255, 255, 0.4);
            backdrop-filter: blur(12px);
            border-radius: 18px;
            border: 1px solid rgba(255, 255, 255, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.03);
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        .ad-banner:hover {
            transform: translateY(-2px);
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 0 8px 25px rgba(0,0,0,0.05);
        }
        .ad-label {
            position: absolute;
            top: 4px;
            left: 8px;
            font-size: 7px;
            font-weight: 900;
            color: rgba(0,0,0,0.2);
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .ad-content-text {
            font-size: 11px;
            font-weight: 800;
            color: #1e293b;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: flex;
            align-items: center; gap: 8px;
        }
        .ad-image {
            width: 24px;
            height: 24px;
            object-fit: contain;
            border-radius: 4px;
        }
        .ad-dot-pulse {
            width: 6px;
            height: 6px;
            background: #2563eb;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(37, 99, 235, 0.7); }
            70% { transform: scale(1.1); opacity: 0.6; box-shadow: 0 0 0 8px rgba(37, 99, 235, 0); }
            100% { transform: scale(1); opacity: 1; box-shadow: 0 0 0 0 rgba(37, 99, 235, 0); }
        }
        @media (max-width: 768px) {
            .ad-banner {
                margin: 16px 0;
                width: 100%;
                order: 2;
            }
        }
        
        .ios-select-wrapper { position: relative; width: 100%; }
        .ios-select-wrapper::after {
            content: "";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 10px; height: 10px;
            border-right: 2px solid #94a3b8;
            border-bottom: 2px solid #94a3b8;
            transform: translateY(-70%) rotate(45deg);
            pointer-events: none;
        }
        .ios-select {
            appearance: none;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            background: rgba(255, 255, 255, 0.9) !important;
            backdrop-filter: blur(8px);
            font-family: 'Plus Jakarta Sans', sans-serif;
            font-weight: 800;
            letter-spacing: -0.01em;
            border: 1px solid rgba(0, 0, 0, 0.05) !important;
        }
        .history-search-input {
            background: rgba(255, 255, 255, 0.85);
            border: 1px solid rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(4px);
            border-radius: 12px;
            padding: 8px 16px;
            font-size: 11px;
            font-weight: 700;
            outline: none;
            width: 100%;
            max-width: 200px;
            transition: all 0.3s ease;
            color: #1e293b;
        }

        .avatar-circle-display {
            width: 44px;
            height: 44px;
            background: #fff;
            border-radius: 50%;
            border: 2px solid rgba(37, 99, 235, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .avatar-circle-display:hover {
            transform: scale(1.05);
            border-color: rgba(37, 99, 235, 0.5);
        }
        .avatar-circle-display img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-preview-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 16px;
        }
        .avatar-preview-large {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #f8fafc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 40px;
            border: 3px solid #eff6ff;
            overflow: hidden;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            margin-bottom: 16px;
        }
        .avatar-preview-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .upload-avatar-btn {
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 14px;
            background: rgba(37, 99, 235, 0.05);
            border: 1px dashed #2563eb;
            border-radius: 16px;
            font-size: 11px;
            font-weight: 700;
            color: #2563eb;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .upload-avatar-btn:hover {
            background: rgba(37, 99, 235, 0.1);
        }
    </style>
<script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@^18.2.0",
    "react-dom": "https://esm.sh/react-dom@^18.2.0",
    "react/": "https://esm.sh/react@^18.2.0/"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        const TransactionType = { INCOME: 'INCOME', EXPENSE: 'EXPENSE', ALL: 'ALL' };
        const UserRole = { ADMIN: 'ADMIN', USER: 'USER' };
        const PaymentMethod = { CASH: 'CASH', BKASH: 'BKASH', NAGAD: 'NAGAD', BANK: 'BANK' };

        // Supabase Project Config (Updated)
        const SUPABASE_URL = "https://fjfoogwtqnptpebzyziv.supabase.co";
        const SUPABASE_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqZm9vZ3d0cW5wdHBlYnp5eml2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzIyMTgzMTgsImV4cCI6MjA4Nzc5NDMxOH0.KIauD0OEmdKm2S2WodjVqXJRfXUtwbYsq_81uYnH1p4";
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        /**
         * Robust Cloud Sync & Migration Layer
         */
        const CloudSync = {
            async migrateLocalData(userId) {
                const localKey = `GLOBAL_TX_${userId}`;
                const localData = localStorage.getItem(localKey);
                if (localData) {
                    try {
                        const txs = JSON.parse(localData);
                        for (const tx of txs) {
                            await sb.from('transactions').upsert({
                                id: tx.id,
                                user_id: userId,
                                description: tx.description,
                                amount: tx.amount,
                                type: tx.type,
                                method: tx.method || 'CASH',
                                date: tx.date
                            });
                        }
                        localStorage.removeItem(localKey);
                    } catch (e) { console.error("Migration to Supabase failed", e); }
                }
            },
            async getAllUsers() {
                const { data, error } = await sb.from('users').select('*');
                if (error) {
                  console.error("Fetch Users Failed:", error);
                  return JSON.parse(localStorage.getItem('GLOBAL_WARRICK_USERS') || '[]');
                }
                return data || [];
            },
            async saveUser(user) {
                const { error } = await sb.from('users').upsert({
                    email: user.email,
                    name: user.name,
                    mobile: user.mobile,
                    pass: user.pass,
                    role: user.role,
                    username: user.username,
                    avatar: user.avatar || 'ðŸ‘¤'
                });
                
                if (error) {
                    console.error("Error saving user to Supabase:", error);
                    alert("Sync Error: " + error.message);
                }
                
                // Local fallback sync
                const users = JSON.parse(localStorage.getItem('GLOBAL_WARRICK_USERS') || '[]');
                const idx = users.findIndex(u => u.email === user.email);
                if (idx > -1) users[idx] = user; else users.push(user);
                localStorage.setItem('GLOBAL_WARRICK_USERS', JSON.stringify(users));
                return user;
            },
            async getTransactions(userId) {
                const { data, error } = await sb.from('transactions').select('*').eq('user_id', userId).order('date', { ascending: false });
                if (error) {
                    console.error("Fetch Transactions Failed:", error);
                    return [];
                }
                return (data || []).map(t => ({ ...t, amount: parseFloat(t.amount) }));
            },
            async syncTransactions(userId, txs) {
                const { error } = await sb.from('transactions').upsert(txs.map(t => ({
                    id: t.id,
                    user_id: userId,
                    description: t.description,
                    amount: t.amount,
                    type: t.type,
                    method: t.method || 'CASH',
                    date: t.date
                })));
                if (error) console.error("Transaction Sync Failed:", error);
                return !error;
            },
            async deleteTransaction(id) {
                const { error } = await sb.from('transactions').delete().eq('id', id);
                if (error) console.error("Transaction Delete Failed:", error);
            }
        };

        const StatCard = ({ label, amount, type, currencySymbol, transactions, style }) => {
            const [isRevealed, setIsRevealed] = useState(false);
            const [selectedMethod, setSelectedMethod] = useState(PaymentMethod.CASH);
            const getStyle = () => {
                switch (type) {
                    case 'income': return 'bg-green-100/60 text-emerald-600 border border-white';
                    case 'expense': return 'bg-red-100/60 text-rose-600 border border-white';
                    case 'balance': return 'bg-blue-100/60 text-blue-700 border border-white';
                    default: return 'bg-white text-slate-800 border border-white';
                }
            };
            const toggleReveal = () => setIsRevealed(!isRevealed);
            const methodTotals = useMemo(() => {
                const res = { CASH: 0, BKASH: 0, NAGAD: 0, BANK: 0 };
                transactions.forEach(t => {
                    const val = (t.type === TransactionType.INCOME) ? t.amount : -t.amount;
                    if (res.hasOwnProperty(t.method)) res[t.method] += val;
                    else res['CASH'] += val;
                });
                return res;
            }, [transactions]);
            const displayAmount = useMemo(() => {
                if (type === 'balance') return methodTotals[selectedMethod];
                return transactions
                    .filter(t => (type === 'income' ? t.type === TransactionType.INCOME : t.type === TransactionType.EXPENSE) && (t.method === selectedMethod || (!t.method && selectedMethod === 'CASH')))
                    .reduce((acc, t) => acc + t.amount, 0);
            }, [type, methodTotals, transactions, selectedMethod]);
            return (
                <div style={style} className={`ios-widget p-6 md:p-7 ios-glass ${getStyle()} flex flex-col justify-between h-44 md:h-48 shadow-2xl animate-ios relative overflow-hidden opacity-0`}>
                    <div className="flex flex-col gap-1">
                        <div className="flex justify-between items-center w-full">
                            <p className={`text-[10px] md:text-[11px] font-black uppercase tracking-widest ${type === 'balance' ? 'text-blue-500' : (type === 'income' ? 'text-emerald-500' : 'text-rose-500')}`}>{label}</p>
                            <div className="flex gap-1 p-1 bg-white/40 rounded-xl border border-white/60 overflow-x-auto scrollbar-hide">
                                {[PaymentMethod.CASH, PaymentMethod.BKASH, PaymentMethod.NAGAD, PaymentMethod.BANK].map(m => (
                                    <button key={m} onClick={() => setSelectedMethod(m)} className={`px-2.5 py-1 rounded-lg text-[8px] font-black tracking-tight transition-all flex-shrink-0 ${selectedMethod === m ? 'bg-white text-slate-900 shadow-sm' : 'text-slate-400'}`}>{m}</button>
                                ))}
                            </div>
                        </div>
                        <div className="mt-3">
                            <div onClick={toggleReveal} className={`balance-slider-bg type-${type} ${isRevealed ? 'active' : ''}`}>
                                <div className="balance-slider-text opacity-60">{isRevealed ? 'REVEALED' : `TAP TO ${selectedMethod}`}</div>
                                <div className="balance-slider-thumb">à§³</div>
                            </div>
                        </div>
                    </div>
                    <h2 className={`text-2xl md:text-3xl font-extrabold tabular-nums tracking-tighter leading-none transition-all duration-500 ${!isRevealed ? 'blur-md opacity-20' : 'opacity-100'}`}>
                        <span className="text-lg md:text-xl mr-1 font-medium opacity-70">{currencySymbol}</span>
                        {displayAmount.toLocaleString(undefined, { minimumFractionDigits: 2 })}
                    </h2>
                </div>
            );
        };

        const Logo = ({ className = "" }) => (
            <div className={`brand-container ${className}`}>
                <h1 className="text-4xl md:text-5xl brand-text">WARRICK<span className="brand-dot">.</span></h1>
                <div className="brand-underline"></div>
                <div className="powered-tag">POWERED BY ARVIN</div>
            </div>
        );

        const AdBanner = () => (
            <a href="https://www.cellexbd.online" target="_blank" rel="noopener noreferrer" className="ad-banner">
                <span className="ad-label">Advertisement</span>
                <div className="ad-content-text">
                    <img src="https://api.dicebear.com/7.x/shapes/svg?seed=cellex" alt="Cellex" className="ad-image" />
                    <div className="ad-dot-pulse"></div>
                    PREMIUM CLOUD SYNC ACTIVE
                </div>
            </a>
        );

        const App = () => {
            const [view, setView] = useState('signin');
            const [currentUser, setCurrentUser] = useState(null);
            const [transactions, setTransactions] = useState([]);
            const [filterType, setFilterType] = useState(TransactionType.ALL);
            const [timeRange, setTimeRange] = useState('ALL');
            const [entryType, setEntryType] = useState(TransactionType.EXPENSE);
            const [entryMethod, setEntryMethod] = useState(PaymentMethod.CASH);
            const [isLoading, setIsLoading] = useState(false);
            const [editingId, setEditingId] = useState(null);
            const [editBuffer, setEditBuffer] = useState({ description: '', amount: '' });
            const [historySearch, setHistorySearch] = useState('');
            const [showProfileModal, setShowProfileModal] = useState(false);
            const [isEditingProfile, setIsEditingProfile] = useState(false);
            const [profileForm, setProfileForm] = useState({ name: '', email: '', mobile: '', username: '', pass: '', avatar: 'ðŸ‘¤', bio: '' });
            const avatarInputRef = useRef(null);

            useEffect(() => {
                const session = JSON.parse(localStorage.getItem('W_SESSION'));
                if (session) loadUserData(session);
            }, []);

            const loadUserData = async (user) => {
                setIsLoading(true);
                const userId = user.username || user.email;
                await CloudSync.migrateLocalData(userId);
                const txs = await CloudSync.getTransactions(userId);
                setTransactions(txs);
                setCurrentUser(user);
                setProfileForm({ 
                    name: user.name, 
                    email: user.email, 
                    mobile: user.mobile || '', 
                    username: user.username || '', 
                    pass: user.pass, 
                    avatar: user.avatar || 'ðŸ‘¤',
                    bio: user.bio || 'A Finance Enthusiast focused on smart money management.'
                });
                setView('dashboard');
                setIsLoading(false);
            };

            const handleSignin = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                const fd = new FormData(e.target);
                const login = fd.get('login');
                const pass = fd.get('pass');
                try {
                    const users = await CloudSync.getAllUsers();
                    const user = users.find(u => (u.email === login || u.mobile === login || u.username === login) && u.pass === pass);
                    if (user) {
                        localStorage.setItem('W_SESSION', JSON.stringify(user));
                        await loadUserData(user);
                    } else { alert('Invalid Credentials'); }
                } catch(e) { console.error(e); }
                setIsLoading(false);
            };

            const handleSignup = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                const fd = new FormData(e.target);
                const email = fd.get('email');
                const name = fd.get('name');
                const mobile = fd.get('mobile');
                const pass = fd.get('pass');
                
                const newUser = {
                    name, email, username: email,
                    mobile, pass,
                    role: UserRole.USER, avatar: 'ðŸ‘¤'
                };
                
                try {
                    await CloudSync.saveUser(newUser);
                    localStorage.setItem('W_SESSION', JSON.stringify(newUser));
                    await loadUserData(newUser);
                } catch (e) {
                    console.error("Signup failed:", e);
                    alert("Account creation failed. Please check your connection.");
                }
                setIsLoading(false);
            };

            const handleProfileUpdate = async (e) => {
                e.preventDefault();
                setIsLoading(true);
                const updatedUser = { ...currentUser, ...profileForm };
                await CloudSync.saveUser(updatedUser);
                setCurrentUser(updatedUser);
                localStorage.setItem('W_SESSION', JSON.stringify(updatedUser));
                setIsEditingProfile(false);
                setIsLoading(false);
            };

            const handleAvatarUpload = (e) => {
                const file = e.target.files[0];
                if (!file) return;
                const reader = new FileReader();
                reader.onloadend = () => {
                    setProfileForm({ ...profileForm, avatar: reader.result });
                };
                reader.readAsDataURL(file);
            };

            const filteredTxs = useMemo(() => {
                let list = [...transactions];
                if (filterType !== TransactionType.ALL) list = list.filter(t => t.type === filterType);
                if (timeRange !== 'ALL' && timeRange !== 'Custom') {
                    const now = new Date().getTime();
                    const ranges = { '24H': 86400000, '7D': 604800000, '30D': 2592000000, '3M': 7776000000, '6M': 15552000000, '1Y': 31536000000, '2Y': 63072000000, '5Y': 157680000000 };
                    const limit = now - (ranges[timeRange] || 0);
                    if(ranges[timeRange]) list = list.filter(t => new Date(t.date).getTime() >= limit);
                }
                if (historySearch.trim() !== '') {
                    const query = historySearch.toLowerCase();
                    list = list.filter(t => t.description.toLowerCase().includes(query) || (t.method && t.method.toLowerCase().includes(query)));
                }
                return list.sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());
            }, [transactions, filterType, timeRange, historySearch]);

            const handleDelete = async (id) => {
                const updated = transactions.filter(tx => tx.id !== id);
                setTransactions(updated);
                await CloudSync.deleteTransaction(id);
            };

            const saveTransaction = async (newTx) => {
                const updated = [newTx, ...transactions];
                setTransactions(updated);
                await CloudSync.syncTransactions(currentUser.username || currentUser.email, updated);
            };

            const exportToPDF = () => {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF('p', 'mm', 'a4');
                const pageWidth = doc.internal.pageSize.getWidth();
                const darkColor = [30, 41, 59], accentColor = [251, 191, 36];
                doc.setFillColor(...darkColor); doc.rect(0, 0, pageWidth, 50, 'F');
                doc.setTextColor(255, 255, 255); doc.setFont("helvetica", "bold"); doc.setFontSize(28); doc.text("WARRICK.", 15, 25);
                doc.setFontSize(8); doc.text("POWERED BY ARVIN", 15, 30);
                doc.setFontSize(9); doc.text(`User: ${currentUser.name}`, pageWidth - 15, 20, { align: 'right' });
                doc.text(`Date: ${new Date().toLocaleDateString()}`, pageWidth - 15, 30, { align: 'right' });
                const tableData = transactions.map(t => [new Date(t.date).toLocaleDateString(), t.description, t.method || 'CASH', t.type, `à§³${t.amount.toFixed(2)}`]);
                doc.autoTable({
                    startY: 110, head: [['DATE', 'ITEM DESCRIPTION', 'METHOD', 'TYPE', 'TOTAL']], body: tableData, theme: 'plain',
                    headStyles: { fillColor: accentColor, textColor: [0, 0, 0], fontStyle: 'bold', halign: 'center' },
                });
                doc.save(`Warrick_Wallet_Report_${currentUser.name.replace(/\s+/g, '_')}.pdf`);
            };

            if (view !== 'dashboard') {
                return (
                    <div className="fixed inset-0 flex items-center justify-center p-6 bg-[#e0e5ec]">
                        <div className="w-full max-w-[400px] animate-ios opacity-0">
                            <div className="text-center mb-10"><Logo /></div>
                            <div className="neumorphic-card p-10 md:p-12">
                                {view === 'signin' && (
                                    <form onSubmit={handleSignin} className="space-y-6 text-center flex flex-col items-center">
                                        <input name="login" required placeholder="Email or Mobile" className="neumorphic-input w-full font-medium" />
                                        <input name="pass" type="password" required placeholder="Password" className="neumorphic-input w-full font-medium" />
                                        <button disabled={isLoading} className="px-10 glassy-admin-btn mt-2">
                                            {isLoading ? 'SIGNING IN...' : 'Sign In'}
                                        </button>
                                        <div className="flex flex-col items-center mt-6 pt-6 border-t border-slate-300 w-full">
                                            <button type="button" onClick={() => setView('admin')} className="glassy-admin-btn mb-4 px-10">Admin Portal</button>
                                            <div className="reg-teaser"><p className="text-xs font-bold text-slate-500">New to Warrick?</p><button type="button" onClick={() => setView('signup')}>Register</button></div>
                                        </div>
                                    </form>
                                )}
                                {view === 'admin' && (
                                    <form onSubmit={(e) => { e.preventDefault(); if (e.target.id.value === 'arvin_hanif' && e.target.pw.value === 'arvin_hanif') { loadUserData({ name: 'Arvin Hanif', email: 'admin@warrick.io', role: UserRole.ADMIN, username: 'arvin_hanif', avatar: 'ðŸ‘¤' }); } }} className="space-y-6 flex flex-col items-center">
                                        <input name="id" required placeholder="Admin ID" className="neumorphic-input w-full font-medium" />
                                        <input name="pw" type="password" required placeholder="Secret" className="neumorphic-input w-full font-medium" />
                                        <button className="px-10 glassy-admin-btn mt-2">Authorize</button>
                                        <div className="flex flex-col items-center mt-6 pt-6 border-t border-slate-300 w-full">
                                            <div className="reg-teaser"><p className="text-xs font-bold text-slate-500">Mistake?</p><button type="button" onClick={() => setView('signin')}>Back to Login</button></div>
                                        </div>
                                    </form>
                                )}
                                {view === 'signup' && (
                                    <form onSubmit={handleSignup} className="space-y-5">
                                        <input name="name" required placeholder="Full Name" className="neumorphic-input" />
                                        <input name="email" required type="email" placeholder="Email" className="neumorphic-input" />
                                        <input name="mobile" required placeholder="Mobile" className="neumorphic-input" />
                                        <input name="pass" type="password" required placeholder="Password" className="neumorphic-input" />
                                        <button disabled={isLoading} className="w-full py-4 neumorphic-button font-bold text-lg">
                                            {isLoading ? 'CREATING ACCOUNT...' : 'Join Warrick'}
                                        </button>
                                        <div className="flex flex-col items-center mt-6 pt-6 border-t border-slate-300">
                                            <div className="reg-teaser"><p className="text-xs font-bold text-slate-500">Already a member?</p><button type="button" onClick={() => setView('signin')}>Login</button></div>
                                        </div>
                                    </form>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            const incTotal = transactions.filter(t => t.type === TransactionType.INCOME).reduce((a, b) => a + b.amount, 0);
            const expTotal = transactions.filter(t => t.type === TransactionType.EXPENSE).reduce((a, b) => a + b.amount, 0);

            if (showProfileModal) {
                return (
                    <div className="fixed inset-0 bg-white z-[100] overflow-y-auto animate-ios">
                        <div className={`w-full min-h-screen flex items-center justify-center ${isEditingProfile ? 'p-0' : 'p-4 md:p-6'}`}>
                            <div className={`${isEditingProfile ? 'w-full h-full' : 'max-w-[400px] w-full'} opacity-0 animate-ios`}>
                                {!isEditingProfile ? (
                                    <div className="profile-card-container group">
                                        <button onClick={() => setShowProfileModal(false)} className="absolute top-6 right-6 z-30 p-2.5 bg-white/10 backdrop-blur-xl rounded-full text-white/90 hover:bg-white/20 transition-all border border-white/20">
                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M6 18L18 6M6 6l12 12"/></svg>
                                        </button>
                                        
                                        {profileForm.avatar?.startsWith('data:image') ? (
                                            <img src={profileForm.avatar} alt="Profile" className="profile-card-image" />
                                        ) : (
                                            <div className="profile-card-image bg-gradient-to-br from-slate-800 to-slate-900 flex items-center justify-center text-8xl">ðŸ‘¤</div>
                                        )}
                                        
                                        <div className="profile-card-gradient"></div>
                                        
                                        <div className="profile-card-overlay">
                                            <div className="flex items-center mb-1">
                                                <h2 className="text-2xl font-black tracking-tight drop-shadow-md">{profileForm.name}</h2>
                                                <span className="verified-badge !w-4 !h-4 !ml-2">
                                                    <svg className="w-2.5 h-2.5" fill="currentColor" viewBox="0 0 20 20"><path d="M6.267 3.455a3.066 3.066 0 001.745-.723 3.066 3.066 0 013.976 0 3.066 3.066 0 001.745.723 3.066 3.066 0 012.812 2.812c.051.643.304 1.254.723 1.745a3.066 3.066 0 010 3.976 3.066 3.066 0 00-.723 1.745 3.066 3.066 0 01-2.812 2.812 3.066 3.066 0 00-1.745.723 3.066 3.066 0 01-3.976 0 3.066 3.066 0 00-1.745-.723 3.066 3.066 0 01-2.812-2.812 3.066 3.066 0 00-.723-1.745 3.066 3.066 0 010-3.976 3.066 3.066 0 00.723-1.745 3.066 3.066 0 012.812-2.812zm7.44 5.252a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"></path></svg>
                                                </span>
                                            </div>
                                            <p className="text-[13px] text-white/80 mb-6 leading-snug font-semibold line-clamp-2 drop-shadow-sm">
                                                {profileForm.bio}
                                            </p>
                                            
                                            <div className="flex items-center justify-between pt-4 border-t border-white/10">
                                                <div className="flex gap-5">
                                                    <div className="profile-stat-item !text-xs">
                                                        <div className="w-7 h-7 rounded-lg bg-white/10 flex items-center justify-center mr-1">
                                                            <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 005.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/></svg>
                                                        </div>
                                                        {transactions.length}
                                                    </div>
                                                    <div className="profile-stat-item !text-xs">
                                                        <div className="w-7 h-7 rounded-lg bg-white/10 flex items-center justify-center mr-1">
                                                            <svg className="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
                                                        </div>
                                                        {Math.floor((Date.now() - (currentUser.createdAt || Date.now())) / (1000 * 60 * 60 * 24)) + 1}D
                                                    </div>
                                                </div>
                                                <button onClick={() => setIsEditingProfile(true)} className="px-5 py-2.5 bg-white text-black rounded-xl font-black text-[10px] uppercase tracking-wider shadow-lg hover:scale-105 active:scale-95 transition-all">Edit Profile</button>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-[#f8fafc] w-full h-full p-6 md:p-12 overflow-y-auto relative flex flex-col items-center">
                                        <div className="max-w-[700px] w-full animate-ios">
                                            <div className="flex justify-between items-center mb-12">
                                                <div>
                                                    <h2 className="text-4xl font-black text-slate-900 tracking-tight">Settings</h2>
                                                    <p className="text-slate-500 font-medium mt-1">Manage your account and preferences</p>
                                                </div>
                                                <button onClick={() => setIsEditingProfile(false)} className="p-4 bg-white rounded-2xl text-slate-400 hover:text-slate-600 shadow-sm border border-slate-100 transition-all hover:scale-105 active:scale-95">
                                                    <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M6 18L18 6M6 6l12 12"/></svg>
                                                </button>
                                            </div>

                                            <form onSubmit={handleProfileUpdate} className="space-y-12 pb-20">
                                                <div className="flex flex-col items-center">
                                                    <div className="avatar-edit-container">
                                                        <div className="avatar-edit-preview">
                                                            {profileForm.avatar?.startsWith('data:image') ? <img src={profileForm.avatar} alt="Current" /> : (profileForm.avatar || 'ðŸ‘¤')}
                                                        </div>
                                                        <div className="avatar-edit-badge" onClick={() => avatarInputRef.current.click()}>
                                                            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M15 13a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                                                        </div>
                                                        <input type="file" ref={avatarInputRef} className="hidden" accept="image/*" onChange={handleAvatarUpload} />
                                                    </div>
                                                </div>

                                                <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-8">
                                                    <h3 className="form-section-title">
                                                        <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
                                                        Personal Information
                                                    </h3>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                        <div className="md:col-span-2 space-y-1">
                                                            <label className="smart-label">About You</label>
                                                            <textarea className="smart-input min-h-[100px] resize-none" value={profileForm.bio} onChange={e => setProfileForm({...profileForm, bio: e.target.value})} placeholder="Tell us about yourself..." />
                                                        </div>
                                                        <div className="space-y-1">
                                                            <label className="smart-label">Full Name</label>
                                                            <input required className="smart-input" value={profileForm.name} onChange={e => setProfileForm({...profileForm, name: e.target.value})} placeholder="Full Name" />
                                                        </div>
                                                        <div className="space-y-1">
                                                            <label className="smart-label">Username</label>
                                                            <input required className="smart-input" value={profileForm.username} onChange={e => setProfileForm({...profileForm, username: e.target.value})} placeholder="Username" />
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="bg-white p-8 rounded-[2.5rem] shadow-sm border border-slate-100 space-y-8">
                                                    <h3 className="form-section-title">
                                                        <svg className="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>
                                                        Contact & Security
                                                    </h3>
                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                                        <div className="space-y-1">
                                                            <label className="smart-label">Email Address</label>
                                                            <input required className="smart-input" type="email" value={profileForm.email} onChange={e => setProfileForm({...profileForm, email: e.target.value})} placeholder="Email Address" />
                                                        </div>
                                                        <div className="space-y-1">
                                                            <label className="smart-label">Mobile Number</label>
                                                            <input required className="smart-input" value={profileForm.mobile} onChange={e => setProfileForm({...profileForm, mobile: e.target.value})} placeholder="Mobile Number" />
                                                        </div>
                                                        <div className="md:col-span-2 space-y-1">
                                                            <label className="smart-label">Account Password</label>
                                                            <input required className="smart-input" type="password" value={profileForm.pass} onChange={e => setProfileForm({...profileForm, pass: e.target.value})} placeholder="New Password" />
                                                        </div>
                                                    </div>
                                                </div>

                                                <div className="flex gap-4">
                                                    <button type="button" onClick={() => setIsEditingProfile(false)} className="flex-1 py-5 bg-slate-100 text-slate-600 font-bold rounded-[2rem] uppercase tracking-widest text-[12px] transition-all hover:bg-slate-200">
                                                        Cancel
                                                    </button>
                                                    <button disabled={isLoading} className="flex-[2] py-5 bg-blue-600 text-white font-black rounded-[2rem] uppercase tracking-widest text-[12px] shadow-2xl shadow-blue-200 hover:bg-blue-700 transition-all hover:scale-[1.02] active:scale-[0.98]">
                                                        {isLoading ? 'Syncing Changes...' : 'Save Preferences'}
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="w-full min-h-screen py-6 px-4 md:px-10 lg:px-20">
                    <header className="max-w-[1200px] mx-auto mb-8 flex flex-col md:flex-row md:justify-between items-center gap-6 text-center md:text-left animate-ios">
                        <div className="flex items-center gap-4">
                            <Logo className="header-logo" />
                        </div>
                        <AdBanner />
                        <div className="flex items-center gap-3">
                            <div className="avatar-circle-display" onClick={() => setShowProfileModal(true)}>
                                {currentUser.avatar?.startsWith('data:image') ? <img src={currentUser.avatar} alt="Profile" /> : (currentUser.avatar || 'ðŸ‘¤')}
                            </div>
                            <button onClick={exportToPDF} className="px-5 py-2.5 bg-white rounded-2xl text-blue-600 text-[10px] font-black uppercase tracking-widest border border-blue-100 shadow-sm">Export</button>
                            <button onClick={() => {localStorage.removeItem('W_SESSION'); setView('signin');}} className="px-5 py-2.5 bg-white rounded-2xl text-rose-500 font-black text-[10px] uppercase tracking-widest border border-rose-100 shadow-sm">Logout</button>
                        </div>
                    </header>
                    <main className="max-w-[1200px] mx-auto space-y-10 pb-12">
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <StatCard label="Net Balance" amount={incTotal - expTotal} type="balance" currencySymbol="à§³" transactions={transactions} style={{ animationDelay: '0.1s' }} />
                            <StatCard label="Total Income" amount={incTotal} type="income" currencySymbol="à§³" transactions={transactions} style={{ animationDelay: '0.2s' }} />
                            <StatCard label="Total Expenses" amount={expTotal} type="expense" currencySymbol="à§³" transactions={transactions} style={{ animationDelay: '0.3s' }} />
                        </div>
                        <div className={`ios-glass p-6 md:p-10 rounded-[2rem] border border-white shadow-2xl transition-all duration-500 animate-ios opacity-0 ${entryType === TransactionType.EXPENSE ? 'bg-red-100/60' : 'bg-green-100/60'}`} style={{ animationDelay: '0.35s' }}>
                             <div className="flex flex-col md:flex-row md:justify-between items-center gap-4 mb-8">
                                <h3 className="text-xl md:text-2xl font-black text-slate-800 uppercase tracking-widest">New Entry</h3>
                                <div className="p-1 bg-slate-200/50 rounded-2xl flex border border-white">
                                    <button onClick={() => setEntryType(TransactionType.EXPENSE)} className={`px-8 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest ${entryType === TransactionType.EXPENSE ? 'bg-white text-rose-600 shadow-md' : 'text-slate-400'}`}>Expense</button>
                                    <button onClick={() => setEntryType(TransactionType.INCOME)} className={`px-8 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest ${entryType === TransactionType.INCOME ? 'bg-white text-emerald-600 shadow-md' : 'text-slate-400'}`}>Income</button>
                                </div>
                             </div>
                             <form onSubmit={async (e) => {
                                e.preventDefault();
                                const fd = new FormData(e.target);
                                const amt = parseFloat(fd.get('amt'));
                                if(!amt) return;
                                const newTx = { id: Date.now().toString(), description: fd.get('desc'), amount: amt, type: entryType, method: entryMethod, date: new Date().toISOString() };
                                await saveTransaction(newTx);
                                e.target.reset();
                             }} className="grid grid-cols-1 md:grid-cols-4 gap-4">
                                <input name="desc" required placeholder="Memo..." className="px-5 py-4 rounded-2xl bg-white border border-slate-100 outline-none font-bold" />
                                <input name="amt" type="number" step="0.01" required placeholder="Amount (à§³)" className="px-5 py-4 rounded-2xl bg-white border border-slate-100 outline-none font-bold" />
                                <div className="ios-select-wrapper">
                                    <select value={entryMethod} onChange={(e) => setEntryMethod(e.target.value)} className="ios-select w-full px-5 py-4 rounded-2xl border border-slate-100 font-bold h-full">
                                        <option value={PaymentMethod.CASH}>CASH</option>
                                        <option value={PaymentMethod.BKASH}>BKASH</option>
                                        <option value={PaymentMethod.NAGAD}>NAGAD</option>
                                        <option value={PaymentMethod.BANK}>BANK</option>
                                    </select>
                                </div>
                                <button className={`py-4 text-white font-black rounded-2xl uppercase tracking-widest text-[10px] shadow-xl ${entryType === TransactionType.INCOME ? 'bg-emerald-600' : 'bg-rose-600'} ios-button`}>Sync Entry</button>
                             </form>
                        </div>

                        <div className="ios-glass rounded-[2rem] border border-white shadow-2xl overflow-hidden mb-12 animate-ios opacity-0" style={{ animationDelay: '0.4s' }}>
                            <div className="p-6 md:p-8 border-b border-white/40 bg-white/30 flex flex-col lg:flex-row lg:justify-between lg:items-center gap-6">
                                <div className="flex flex-col md:flex-row flex-1 items-center gap-4">
                                    <input type="text" placeholder="Search activity..." value={historySearch} onChange={(e) => setHistorySearch(e.target.value)} className="history-search-input flex-1" />
                                    <div className="ios-glass p-1 rounded-full border border-white shadow-sm flex items-center gap-1">
                                        {['ALL', 'INCOME', 'EXPENSE'].map(f => (
                                            <button key={f} onClick={() => setFilterType(TransactionType[f])} className={`px-5 py-2 rounded-full text-[9px] font-black uppercase tracking-widest transition-all ${filterType === TransactionType[f] ? 'bg-white text-blue-600 shadow-sm' : 'text-slate-500'}`}>{f}</button>
                                        ))}
                                    </div>
                                </div>
                                <div className="flex items-center p-1 bg-slate-200/30 rounded-2xl border border-white/50 overflow-x-auto scrollbar-hide gap-1">
                                    {['ALL', '24H', '7D', '30D', '3M', '6M', '1Y', '2Y', '5Y', 'Custom'].map(range => (
                                        <button key={range} onClick={() => setTimeRange(range)} className={`time-range-btn px-4 py-2.5 rounded-xl text-[9px] font-black uppercase ${timeRange === range ? 'active text-blue-600' : 'text-slate-400'}`}>{range}</button>
                                    ))}
                                </div>
                            </div>
                            <div className="p-3 md:p-6 space-y-2 max-h-[500px] overflow-y-auto">
                                {filteredTxs.map((t, i) => (
                                    <div key={t.id} style={{ animationDelay: `${(i * 0.05) + 0.4}s` }} className={`flex justify-between items-center p-4 rounded-2xl border border-white group animate-ios opacity-0 ${t.type === TransactionType.INCOME ? 'bg-green-100/60' : 'bg-red-100/60'}`}>
                                        <div className="flex items-center gap-3">
                                            <div className="w-10 h-10 rounded-xl flex items-center justify-center bg-white shadow-inner font-black text-xs">{t.type === TransactionType.INCOME ? '+' : '-'}</div>
                                            <div>
                                                <div className="flex items-center gap-2">
                                                    <h4 className="font-bold text-slate-800 text-sm">{t.description}</h4>
                                                    <span className="text-[7px] font-black bg-white/80 px-1.5 py-0.5 rounded border text-slate-400 uppercase">{t.method || 'CASH'}</span>
                                                </div>
                                                <p className="text-[8px] text-slate-500 font-black uppercase tracking-widest">{new Date(t.date).toLocaleString()}</p>
                                            </div>
                                        </div>
                                        <div className="flex items-center gap-2">
                                            <p className={`text-base font-black tracking-tighter ${t.type === TransactionType.INCOME ? 'text-green-700' : 'text-red-700'}`}>à§³{t.amount.toLocaleString(undefined, {minimumFractionDigits: 2})}</p>
                                            <button onClick={() => handleDelete(t.id)} className="text-slate-300 hover:text-rose-500 p-2 opacity-0 group-hover:opacity-100 transition-all"><svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4" viewBox="0 0 20 20" fill="currentColor"><path fillRule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clipRule="evenodd" /></svg></button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>

                    </main>
                </div>
            );
        };
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
<script type="module" src="/index.tsx"></script>
</body>
</html>